# GitHub Actions 工作流文件名： daily_report.yml

name: Daily Crypto Market Report

# 工作流的触发器
on:
  # 1. 定时触发：使用Cron语法，'0 1 * * *' 代表每天UTC时间凌晨1点运行。
  #    换算成北京/新加坡时间就是每天早上9点。
  schedule:
    - cron: '0 1 * * *'
  
  # 2. 手动触发：允许你在GitHub Actions页面手动点击运行，方便测试。
  workflow_dispatch:

jobs:
  build-and-run:
    # 运行环境：使用最新的Ubuntu系统
    runs-on: ubuntu-latest

    steps:
      # 第一步：检出你的代码
      # 使用 `actions/checkout@v4` 这个官方的action，将你的仓库代码下载到运行环境中
      - name: Check out repository code
        uses: actions/checkout@v4

      # 第二步：设置Python环境
      # 使用 `actions/setup-python@v5`，并指定我们需要的Python 3.11版本
      - name: Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      # 第三步：安装所有依赖库
      # 运行 `pip install` 命令，从 `requirements.txt` 文件安装所有库
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # 第四步：运行主程序
      # 执行 `summary.py` 脚本，并注入我们设置的Secrets作为环境变量
      - name: Run the market analysis script
        env:
          GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
          NEWS_API_KEY: ${{ secrets.NEWS_API_KEY }}
          COVALENT_API_KEY: ${{ secrets.COVALENT_API_KEY }}
          ETHERSCAN_API_KEY: ${{ secrets.ETHERSCAN_API_KEY }}
        run: python summary.py
